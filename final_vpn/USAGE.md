# ğŸ“– Rust VPN ä½¿ç”¨æŒ‡å—

æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨æœ¬ VPN çš„ä¸¤ç§å·¥ä½œæ¨¡å¼ï¼š**ç‚¹å¯¹ç‚¹æ¨¡å¼**å’Œ**ç½‘å…³æ¨¡å¼**ã€‚

---

## ğŸ“‹ ç›®å½•

- [æ¨¡å¼å¯¹æ¯”](#æ¨¡å¼å¯¹æ¯”)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [ç‚¹å¯¹ç‚¹æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰](#ç‚¹å¯¹ç‚¹æ¨¡å¼é»˜è®¤)
- [ç½‘å…³æ¨¡å¼](#ç½‘å…³æ¨¡å¼)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥](#å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥)

---

## æ¨¡å¼å¯¹æ¯”

### ğŸ”— ç‚¹å¯¹ç‚¹æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰

```
å®¢æˆ·ç«¯ A <--VPN--> æœåŠ¡å™¨ <--VPN--> å®¢æˆ·ç«¯ B
(10.0.0.2)       (10.0.0.1)       (10.0.0.3)
```

**ç‰¹ç‚¹ï¼š**
- âœ… å®¢æˆ·ç«¯ä¹‹é—´å¯ä»¥äº’ç›¸é€šä¿¡ï¼ˆé€šè¿‡è™šæ‹Ÿ IPï¼‰
- âŒ æ— æ³•è®¿é—®äº’è”ç½‘
- âœ… ä¸éœ€è¦ç‰¹æ®Šæƒé™ï¼ˆæ™®é€šç”¨æˆ·å¯è¿è¡Œï¼‰
- âœ… é€‚ç”¨åœºæ™¯ï¼šå†…ç½‘ç©¿é€ã€æ–‡ä»¶å…±äº«ã€æ¸¸æˆè”æœº

**å…¸å‹åº”ç”¨ï¼š**
- åœ¨ä¸åŒç½‘ç»œçš„è®¾å¤‡é—´å»ºç«‹ç§å¯†é€šé“
- å¤šä¸ªå®¢æˆ·ç«¯ç»„å»ºè™šæ‹Ÿå±€åŸŸç½‘
- å¼€å‘ç¯å¢ƒä¸­çš„æœåŠ¡äº’è®¿

---

### ğŸŒ ç½‘å…³æ¨¡å¼ï¼ˆ`--gateway`ï¼‰

```
å®¢æˆ·ç«¯ A <--VPN--> æœåŠ¡å™¨ <--NAT--> äº’è”ç½‘
(10.0.0.2)       (10.0.0.1)         (å…¬ç½‘)
```

**ç‰¹ç‚¹ï¼š**
- âœ… å®¢æˆ·ç«¯ä¹‹é—´å¯ä»¥äº’ç›¸é€šä¿¡
- âœ… å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡æœåŠ¡å™¨è®¿é—®äº’è”ç½‘
- âš ï¸ éœ€è¦ `sudo` æƒé™ï¼ˆé…ç½® IP è½¬å‘å’Œ NATï¼‰
- âœ… é€‚ç”¨åœºæ™¯ï¼šä»£ç†ä¸Šç½‘ã€éšè—çœŸå® IPã€çªç ´ç½‘ç»œé™åˆ¶

**å…¸å‹åº”ç”¨ï¼š**
- åœ¨å—é™ç½‘ç»œä¸­è®¿é—®äº’è”ç½‘
- éšè—å®¢æˆ·ç«¯çš„çœŸå® IP åœ°å€
- å°†æœåŠ¡å™¨ä½œä¸ºå‡ºå£ç½‘å…³ä½¿ç”¨

---

## å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ ç¼–è¯‘é¡¹ç›®

```bash
cd final_vpn
cargo build --release
```

ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ä½äº `target/release/` ç›®å½•ã€‚

---

### 2ï¸âƒ£ ç”Ÿæˆå¯†é’¥å¯¹

æœåŠ¡ç«¯é¦–æ¬¡å¯åŠ¨ä¼šè‡ªåŠ¨ç”Ÿæˆ Ed25519 å¯†é’¥å¯¹ï¼š

```bash
./target/release/vpn_server
```

å¯†é’¥æ–‡ä»¶ä¿å­˜åœ¨ `keys/` ç›®å½•ï¼š
- `server_private.key` - æœåŠ¡ç«¯ç§é’¥ï¼ˆå¿…é¡»ä¿å¯†ï¼‰
- `server_public.key` - æœåŠ¡ç«¯å…¬é’¥ï¼ˆéœ€åˆ†å‘ç»™å®¢æˆ·ç«¯ï¼‰

**âš ï¸ é‡è¦**ï¼šå®¢æˆ·ç«¯éœ€è¦é¢„å…ˆè·å– `server_public.key` æ‰èƒ½è¿æ¥ã€‚

---

## ç‚¹å¯¹ç‚¹æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰

### åœºæ™¯ 1ï¼šæœ¬åœ°æµ‹è¯•ï¼ˆå•æœºå¤šå®¢æˆ·ç«¯ï¼‰

**ç»ˆç«¯ 1 - å¯åŠ¨æœåŠ¡ç«¯ï¼š**
```bash
./target/release/vpn_server
```

**ç»ˆç«¯ 2 - å¯åŠ¨å®¢æˆ·ç«¯ Aï¼š**
```bash
sudo ./target/release/vpn_client 10.0.0.2 127.0.0.1:9000
```

**ç»ˆç«¯ 3 - å¯åŠ¨å®¢æˆ·ç«¯ Bï¼š**
```bash
sudo ./target/release/vpn_client 10.0.0.3 127.0.0.1:9000
```

**ç»ˆç«¯ 2 - æµ‹è¯•è¿é€šæ€§ï¼š**
```bash
ping 10.0.0.3
```

âœ… **æˆåŠŸæ ‡å¿—**ï¼šå®¢æˆ·ç«¯ A å¯ä»¥ ping é€šå®¢æˆ·ç«¯ Bï¼ˆ10.0.0.3ï¼‰

---

### åœºæ™¯ 2ï¼šè·¨ç½‘ç»œéƒ¨ç½²

#### åœ¨æœåŠ¡å™¨ä¸Šï¼ˆå‡è®¾å…¬ç½‘ IP: `1.2.3.4`ï¼‰

```bash
# 1. ä¸Šä¼ ä»£ç 
scp -r final_vpn user@1.2.3.4:~/

# 2. SSH ç™»å½•å¹¶ç¼–è¯‘
ssh user@1.2.3.4
cd final_vpn
cargo build --release

# 3. è¿è¡ŒæœåŠ¡ç«¯
./target/release/vpn_server

# 4. ä¸‹è½½å…¬é’¥åˆ°æœ¬åœ°
# åœ¨æœ¬åœ°æ‰§è¡Œï¼š
scp user@1.2.3.4:~/final_vpn/keys/server_public.key ./keys/
```

#### åœ¨å®¢æˆ·ç«¯

**å®¢æˆ·ç«¯ Aï¼ˆä½ çš„ç”µè„‘ï¼‰ï¼š**
```bash
sudo ./target/release/vpn_client 10.0.0.2 1.2.3.4:9000
```

**å®¢æˆ·ç«¯ Bï¼ˆå¦ä¸€å°ç”µè„‘ï¼‰ï¼š**
```bash
sudo ./target/release/vpn_client 10.0.0.3 1.2.3.4:9000
```

**æµ‹è¯•è¿é€šï¼š**
```bash
# åœ¨å®¢æˆ·ç«¯ A
ping 10.0.0.3

# åœ¨å®¢æˆ·ç«¯ B
ping 10.0.0.2
```

---

## ç½‘å…³æ¨¡å¼

### Linux é…ç½®

#### æœåŠ¡ç«¯é…ç½®

**1. å¯åŠ¨æœåŠ¡ç«¯ï¼ˆè‡ªåŠ¨é…ç½®ï¼‰ï¼š**
```bash
sudo ./target/release/vpn_server --gateway
```

ç¨‹åºä¼šè‡ªåŠ¨ï¼š
- âœ… åˆ›å»º TUN è®¾å¤‡ï¼ˆtun0ï¼‰
- âœ… å¯ç”¨ IP è½¬å‘ï¼ˆ`/proc/sys/net/ipv4/ip_forward = 1`ï¼‰
- âœ… æ£€æµ‹å¤–ç½‘æ¥å£ï¼ˆå¦‚ eth0ï¼‰
- âœ… é…ç½® iptables NAT è§„åˆ™

**2. éªŒè¯é…ç½®ï¼š**
```bash
# æ£€æŸ¥ IP è½¬å‘
cat /proc/sys/net/ipv4/ip_forward
# è¾“å‡ºåº”ä¸º: 1

# æ£€æŸ¥ iptables NAT è§„åˆ™
sudo iptables -t nat -L POSTROUTING -n -v
# åº”çœ‹åˆ° MASQUERADE è§„åˆ™

# æ£€æŸ¥ FORWARD é“¾
sudo iptables -L FORWARD -n -v
# åº”çœ‹åˆ°ä¸¤æ¡ ACCEPT è§„åˆ™
```

**3. åœæ­¢æœåŠ¡åæ¸…ç†è§„åˆ™ï¼ˆå¯é€‰ï¼‰ï¼š**
```bash
# å‡è®¾å¤–ç½‘æ¥å£æ˜¯ eth0ï¼ŒTUN è®¾å¤‡æ˜¯ tun0
sudo iptables -D FORWARD -i tun0 -o eth0 -j ACCEPT
sudo iptables -D FORWARD -i eth0 -o tun0 -m state --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE
```

---

#### å®¢æˆ·ç«¯é…ç½®

**æ–¹å¼ 1ï¼šå…¨éš§é“æ¨¡å¼ï¼ˆæ‰€æœ‰æµé‡èµ° VPNï¼‰**
```bash
sudo ./target/release/vpn_client 10.0.0.2 <æœåŠ¡å™¨IP>:9000 --full-tunnel
```

**æ•ˆæœï¼š**
- é»˜è®¤è·¯ç”±æŒ‡å‘ VPN
- æ‰€æœ‰ç½‘ç»œæµé‡é€šè¿‡æœåŠ¡å™¨
- å…¬ç½‘ IP å˜ä¸ºæœåŠ¡å™¨ IP

**æ–¹å¼ 2ï¼šåˆ†æµæ¨¡å¼ï¼ˆä»… VPN ç½‘æ®µèµ° VPNï¼‰**
```bash
sudo ./target/release/vpn_client 10.0.0.2 <æœåŠ¡å™¨IP>:9000
```

**æ•ˆæœï¼š**
- ä»… 10.0.0.0/24 èµ° VPN
- å…¶ä»–æµé‡èµ°æœ¬åœ°ç½‘å…³
- é€‚åˆéœ€è¦åŒæ—¶è®¿é—®å†…ç½‘å’Œ VPN çš„åœºæ™¯

---

#### æµ‹è¯•è¿æ¥

**1. Ping äº’è”ç½‘ï¼š**
```bash
ping 8.8.8.8
ping google.com
```

**2. æŸ¥çœ‹å…¬ç½‘ IPï¼š**
```bash
curl ifconfig.me
# åº”æ˜¾ç¤ºæœåŠ¡å™¨çš„å…¬ç½‘ IP
```

**3. è®¿é—®ç½‘é¡µï¼š**
```bash
curl -I https://www.google.com
# åº”è¿”å› HTTP 200 å“åº”å¤´
```

**4. æŸ¥çœ‹è·¯ç”±è¡¨ï¼š**
```bash
# å…¨éš§é“æ¨¡å¼åº”çœ‹åˆ° default æŒ‡å‘ TUN è®¾å¤‡
ip route | grep default
```

---

### macOS é…ç½®

#### æœåŠ¡ç«¯é…ç½®ï¼ˆéœ€æ‰‹åŠ¨é…ç½® pfctlï¼‰

**1. å¯åŠ¨æœåŠ¡ç«¯ï¼š**
```bash
sudo ./target/release/vpn_server --gateway
```

ç¨‹åºä¼šæç¤ºéœ€è¦æ‰‹åŠ¨é…ç½® pfctlã€‚

**2. æ£€æµ‹å¤–ç½‘æ¥å£ï¼š**
```bash
route -n get default | grep interface
# é€šå¸¸æ˜¯ en0 æˆ– en1
```

**3. åˆ›å»º pf è§„åˆ™æ–‡ä»¶ï¼š**
```bash
sudo nano /etc/pf.anchors/vpn
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆå‡è®¾å¤–ç½‘æ¥å£æ˜¯ `en0`ï¼‰ï¼š
```pf
# NAT è§„åˆ™ï¼šå°† 10.0.0.0/24 ä¼ªè£…æˆ en0 çš„ IP
nat on en0 from 10.0.0.0/24 to any -> (en0)

# å…è®¸è½¬å‘
pass in on utun quick
pass out on en0 quick
```

**4. åŠ è½½å¹¶å¯ç”¨è§„åˆ™ï¼š**
```bash
# å¯ç”¨ IP è½¬å‘ï¼ˆå·²ç”±ç¨‹åºè‡ªåŠ¨å®Œæˆï¼‰
sudo sysctl -w net.inet.ip.forwarding=1

# åŠ è½½ pf è§„åˆ™
sudo pfctl -ef /etc/pf.anchors/vpn

# æŸ¥çœ‹è§„åˆ™çŠ¶æ€
sudo pfctl -sr
```

**5. åœæ­¢æœåŠ¡åæ¸…ç†è§„åˆ™ï¼ˆå¯é€‰ï¼‰ï¼š**
```bash
sudo pfctl -d          # ç¦ç”¨ pf
sudo pfctl -F all      # æ¸…é™¤æ‰€æœ‰è§„åˆ™
```

---

#### å®¢æˆ·ç«¯é…ç½®

ä¸ Linux ç›¸åŒï¼Œä½¿ç”¨ `--full-tunnel` å‚æ•°å¯ç”¨å…¨éš§é“æ¨¡å¼ï¼š

```bash
sudo ./target/release/vpn_client 10.0.0.2 <æœåŠ¡å™¨IP>:9000 --full-tunnel
```

---

## æ•…éšœæ’é™¤

### âŒ æƒé™é”™è¯¯

**é—®é¢˜ï¼š**
```
âŒ å¯ç”¨IPè½¬å‘å¤±è´¥: Permission denied
```

**è§£å†³ï¼š**
å¿…é¡»ä½¿ç”¨ `sudo` è¿è¡Œï¼š
```bash
sudo ./target/release/vpn_server --gateway
sudo ./target/release/vpn_client 10.0.0.2 <æœåŠ¡å™¨IP>:9000
```

---

### âŒ å®¢æˆ·ç«¯æ— æ³•è®¿é—®äº’è”ç½‘

**æ’æŸ¥æ­¥éª¤ï¼š**

1. **æ£€æŸ¥æœåŠ¡ç«¯æ˜¯å¦å¯ç”¨ç½‘å…³æ¨¡å¼ï¼š**
   ```bash
   # åº”è¯¥çœ‹åˆ°è¿™è¡Œè¾“å‡ºï¼š
   ğŸŒ å¯ç”¨ç½‘å…³æ¨¡å¼ï¼ˆNATè½¬å‘åˆ°äº’è”ç½‘ï¼‰
   ```

2. **æ£€æŸ¥ IP è½¬å‘ï¼š**
   ```bash
   # Linux
   cat /proc/sys/net/ipv4/ip_forward
   # è¾“å‡ºåº”ä¸º: 1
   
   # macOS
   sysctl net.inet.ip.forwarding
   # è¾“å‡ºåº”ä¸º: net.inet.ip.forwarding: 1
   ```

3. **æ£€æŸ¥ NAT è§„åˆ™ï¼ˆLinuxï¼‰ï¼š**
   ```bash
   sudo iptables -t nat -L POSTROUTING -n
   # åº”çœ‹åˆ° MASQUERADE è§„åˆ™
   ```

4. **æµ‹è¯•è¿é€šæ€§ï¼š**
   ```bash
   # ä»å®¢æˆ·ç«¯ ping æœåŠ¡ç«¯
   ping 10.0.0.1
   
   # Ping å¤–ç½‘ DNS
   ping 8.8.8.8
   
   # æµ‹è¯• DNS è§£æ
   nslookup google.com 8.8.8.8
   ```

5. **æ£€æŸ¥è·¯ç”±è¡¨ï¼š**
   ```bash
   # Linux
   ip route
   
   # macOS
   netstat -rn
   
   # å…¨éš§é“æ¨¡å¼åº”çœ‹åˆ°ï¼šdefault æŒ‡å‘ TUN è®¾å¤‡
   ```

---

### âŒ macOS pf è§„åˆ™ä¸ç”Ÿæ•ˆ

**é—®é¢˜ï¼š**
NAT è§„åˆ™é…ç½®åä»æ— æ³•è®¿é—®äº’è”ç½‘ã€‚

**è§£å†³ï¼š**

1. **ç¡®è®¤ pf å·²å¯ç”¨ï¼š**
   ```bash
   sudo pfctl -s info | grep Status
   # è¾“å‡ºåº”ä¸º: Status: Enabled
   ```

2. **é‡æ–°åŠ è½½è§„åˆ™ï¼š**
   ```bash
   sudo pfctl -d                      # ç¦ç”¨
   sudo pfctl -ef /etc/pf.anchors/vpn # é‡æ–°å¯ç”¨å¹¶åŠ è½½
   ```

3. **æ£€æŸ¥ utun è®¾å¤‡åç§°ï¼š**
   ```bash
   ifconfig | grep utun
   # ç¡®ä¿ä¸ pf è§„åˆ™ä¸­çš„è®¾å¤‡åä¸€è‡´
   ```

---

### âŒ å…¨éš§é“æ¨¡å¼å¯¼è‡´è¿æ¥ä¸­æ–­

**é—®é¢˜ï¼š**
ä½¿ç”¨ `--full-tunnel` åæ— æ³•è¿æ¥æœåŠ¡å™¨ã€‚

**åŸå› ï¼š**
é»˜è®¤è·¯ç”±ä¿®æ”¹åï¼Œåˆ°æœåŠ¡å™¨çš„è¿æ¥ä¹Ÿè¢«è·¯ç”±åˆ° VPNï¼Œå½¢æˆæ­»å¾ªç¯ã€‚

**è§£å†³æ–¹æ¡ˆ Aï¼šæ·»åŠ æœåŠ¡å™¨è·¯ç”±ä¾‹å¤–ï¼ˆæ¨èï¼‰**
```bash
# åœ¨å¯åŠ¨å®¢æˆ·ç«¯å‰ï¼Œæ·»åŠ æœåŠ¡å™¨è·¯ç”±
# å‡è®¾æœåŠ¡å™¨æ˜¯ 192.168.1.100ï¼Œæœ¬åœ°ç½‘å…³æ˜¯ 192.168.1.1

# Linux
sudo ip route add 192.168.1.100 via 192.168.1.1

# macOS
sudo route add 192.168.1.100 192.168.1.1
```

**è§£å†³æ–¹æ¡ˆ Bï¼šä½¿ç”¨åˆ†æµæ¨¡å¼**
ä¸ä½¿ç”¨ `--full-tunnel`ï¼Œæ‰‹åŠ¨æ·»åŠ éœ€è¦çš„è·¯ç”±ï¼š
```bash
# åªè®©ç‰¹å®šç½‘æ®µèµ° VPN
sudo route add 8.8.8.0/24 10.0.0.1
```

---

### âŒ DNS è§£æå¤±è´¥

**é—®é¢˜ï¼š**
å¯ä»¥ ping é€š IPï¼Œä½†æ— æ³•è§£æåŸŸåã€‚

**è§£å†³ï¼š**

**1. æ‰‹åŠ¨æŒ‡å®š DNS æœåŠ¡å™¨ï¼š**
```bash
# Linux
echo "nameserver 8.8.8.8" | sudo tee /etc/resolv.conf

# macOS
sudo networksetup -setdnsservers Wi-Fi 8.8.8.8 1.1.1.1
```

**2. æµ‹è¯• DNSï¼š**
```bash
nslookup google.com 8.8.8.8
dig @8.8.8.8 google.com
```

---

### âŒ å®¢æˆ·ç«¯æ— æ³•è¿æ¥æœåŠ¡ç«¯

**é—®é¢˜ï¼š**
å®¢æˆ·ç«¯å¯åŠ¨åæ— æ³•å»ºç«‹è¿æ¥ã€‚

**æ’æŸ¥æ­¥éª¤ï¼š**

1. **æ£€æŸ¥é˜²ç«å¢™ï¼š**
   ```bash
   # Linuxï¼ˆå…è®¸ UDP 9000 ç«¯å£ï¼‰
   sudo ufw allow 9000/udp
   sudo ufw enable
   
   # macOSï¼ˆåœ¨ç³»ç»Ÿåå¥½è®¾ç½®ä¸­é…ç½®ï¼‰
   ```

2. **ç¡®è®¤æœåŠ¡ç«¯å·²å¯åŠ¨ï¼š**
   ```bash
   # æŸ¥çœ‹æ˜¯å¦ç›‘å¬ 9000 ç«¯å£
   # Linux
   sudo ss -tunlp | grep 9000
   
   # macOS
   sudo lsof -i UDP:9000
   ```

3. **æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ï¼š**
   ```bash
   # Ping æœåŠ¡å™¨
   ping <æœåŠ¡å™¨IP>
   
   # æµ‹è¯• UDP è¿æ¥ï¼ˆéœ€è¦ nc å·¥å…·ï¼‰
   nc -u <æœåŠ¡å™¨IP> 9000
   ```

4. **ç¡®è®¤å…¬é’¥æ–‡ä»¶å­˜åœ¨ï¼š**
   ```bash
   ls -l keys/server_public.key
   ```

---

## é«˜çº§é…ç½®

### é™åˆ¶å®¢æˆ·ç«¯åªèƒ½è®¿é—®ç‰¹å®šç½‘ç«™

**æœåŠ¡ç«¯ iptablesï¼š**
```bash
# åªå…è®¸è®¿é—® Googleï¼ˆç¤ºä¾‹ï¼‰
sudo iptables -I FORWARD -i tun0 -d 142.250.0.0/16 -j ACCEPT
sudo iptables -I FORWARD -i tun0 -j DROP
```

---

### æŸ¥çœ‹å®æ—¶æµé‡

**å®‰è£… iftopï¼š**
```bash
# Debian/Ubuntu
sudo apt install iftop

# CentOS/RHEL
sudo yum install iftop

# macOS
brew install iftop
```

**ç›‘æ§ TUN è®¾å¤‡æµé‡ï¼š**
```bash
# Linux
sudo iftop -i tun0

# macOS
sudo iftop -i utun8  # æ›¿æ¢ä¸ºå®é™…çš„ utun ç¼–å·
```

---

### MTU è°ƒä¼˜

å¦‚æœé‡åˆ°è¿æ¥ä¸ç¨³å®šæˆ–é€Ÿåº¦æ…¢çš„é—®é¢˜ï¼Œå°è¯•é™ä½ MTUï¼š

```bash
# Linux
sudo ip link set tun0 mtu 1400

# macOS
sudo ifconfig utun8 mtu 1400
```

---

### æŒä¹…åŒ–é…ç½®ï¼ˆæœåŠ¡å™¨é‡å¯åè‡ªåŠ¨ç”Ÿæ•ˆï¼‰

**Linux systemdï¼š**

åˆ›å»ºæœåŠ¡æ–‡ä»¶ï¼š
```bash
sudo nano /etc/systemd/system/vpn-server.service
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
```ini
[Unit]
Description=VPN Server with Gateway
After=network.target

[Service]
Type=simple
ExecStart=/path/to/final_vpn/target/release/vpn_server --gateway
Restart=always
User=root
WorkingDirectory=/path/to/final_vpn

[Install]
WantedBy=multi-user.target
```

å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡ï¼š
```bash
sudo systemctl enable vpn-server
sudo systemctl start vpn-server

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status vpn-server
```

---

## å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

| åŠŸèƒ½ | Linux | macOS |
|------|-------|-------|
| æŸ¥çœ‹è·¯ç”±è¡¨ | `ip route` | `netstat -rn` |
| æŸ¥çœ‹ç½‘å¡ | `ip addr` | `ifconfig` |
| å¯ç”¨IPè½¬å‘ | `echo 1 > /proc/sys/net/ipv4/ip_forward` | `sysctl -w net.inet.ip.forwarding=1` |
| æŸ¥çœ‹ NAT è§„åˆ™ | `iptables -t nat -L` | `pfctl -sr` |
| æ·»åŠ è·¯ç”± | `ip route add` | `route add` |
| åˆ é™¤è·¯ç”± | `ip route del` | `route delete` |
| æŸ¥çœ‹è¿æ¥ | `ss -tunap` | `netstat -an` |
| ç›‘å¬ç«¯å£ | `ss -tunlp` | `lsof -i` |
| æŠ“åŒ… | `tcpdump -i tun0` | `tcpdump -i utun8` |

---

## å®‰å…¨å»ºè®®

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. **ä¿æŠ¤ç§é’¥ï¼š**
   ```bash
   chmod 600 keys/server_private.key
   chown root:root keys/server_private.key
   ```

2. **å®‰å…¨åˆ†å‘å…¬é’¥ï¼š**
   é€šè¿‡ SSHã€HTTPS ç­‰å®‰å…¨æ¸ é“åˆ†å‘ `server_public.key`

3. **é…ç½®é˜²ç«å¢™ï¼š**
   ```bash
   # ä»…å¼€æ”¾ VPN ç«¯å£
   sudo ufw allow 9000/udp
   sudo ufw enable
   ```

4. **é™åˆ¶æº IPï¼ˆå¯é€‰ï¼‰ï¼š**
   åœ¨æœåŠ¡ç«¯ä»£ç ä¸­æ·»åŠ  IP ç™½åå•

5. **å¯ç”¨æ—¥å¿—å®¡è®¡ï¼š**
   ä½¿ç”¨ systemd journal æˆ– syslog ç®¡ç†æ—¥å¿—

6. **å®šæœŸæ›´æ–°ï¼š**
   åŠæ—¶æ›´æ–° Rust ä¾èµ–åº“

---

## æ€§èƒ½ä¼˜åŒ–

- âœ… ä½¿ç”¨ `--release` ç¼–è¯‘ä»¥è·å¾—æœ€ä½³æ€§èƒ½
- âœ… è°ƒæ•´ MTU å¤§å°é¿å…åˆ†ç‰‡ï¼ˆæ¨è 1400ï¼‰
- âœ… åœ¨å¤šæ ¸æœåŠ¡å™¨ä¸Šå¯ç”¨å¤šçº¿ç¨‹å¤„ç†
- âœ… ä½¿ç”¨ `taskset` ç»‘å®š CPU æ ¸å¿ƒï¼ˆLinuxï¼‰
- âœ… è°ƒæ•´ç³»ç»Ÿç½‘ç»œå‚æ•°ï¼ˆTCP buffer size ç­‰ï¼‰

---

## æ€»ç»“

| æ¨¡å¼ | å¯åŠ¨å‘½ä»¤ | æƒé™è¦æ±‚ | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|---------|
| ğŸ”— **ç‚¹å¯¹ç‚¹æ¨¡å¼** | `vpn_server` | æ— éœ€ sudo | å®¢æˆ·ç«¯äº’è”ã€å†…ç½‘ç©¿é€ |
| ğŸŒ **ç½‘å…³æ¨¡å¼** | `vpn_server --gateway` | **éœ€è¦ sudo** | ä»£ç†ä¸Šç½‘ã€éšè— IP |

| å®¢æˆ·ç«¯æ¨¡å¼ | å¯åŠ¨å‘½ä»¤ | æ•ˆæœ |
|-----------|---------|------|
| ğŸ”€ **åˆ†æµæ¨¡å¼** | `vpn_client 10.0.0.2 <æœåŠ¡å™¨>` | ä»… VPN ç½‘æ®µèµ° VPN |
| ğŸŒ **å…¨éš§é“æ¨¡å¼** | `vpn_client 10.0.0.2 <æœåŠ¡å™¨> --full-tunnel` | æ‰€æœ‰æµé‡èµ° VPN |

ç°åœ¨ä½ å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ¨¡å¼ä½¿ç”¨ VPN äº†ï¼ğŸ‰

---

**æœ€åæ›´æ–°**ï¼š2025å¹´12æœˆ25æ—¥  
**ç‰ˆæœ¬**ï¼šv2.0

